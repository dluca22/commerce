{%extends "auctions/layout.html"%}
{% block title %}{{item.title}}{% endblock %}

{% block body%}
<!-- IF there is an error in the page -->
{%if not error %}

    <!-- IF user is authenticated > add to watchlist form -->
    {%if user.is_authenticated %}
                        <form action="{%url 'watch_toggle' item.id %}" method="post">
                        {%csrf_token%}

                            <!-- IF usr is NOT watching listing, display button follow -->
                            {%if is_watching == False %}
                                                <button type="submit" name="watch_toggle" id="watchlist-button" class="btn btn-danger" , value="follow">&lt;3</button>

                                <!-- ELIF usr is watching listing, display button unfollow. -->
                            {%elif is_watching == True%}
                                                <button type="submit" name="watch_toggle" id="watchlist-button" class="btn btn-warning" , value="unfollow">&lt;/3</button>
                            <!-- ENDIF is watching -->
                            {%endif%}
                        </form>

    <!-- ENDIF user authenticated -->
    {%endif%}


    <!-- people watching counter -->
    <p><u>People watching =</u> ( <b>{{item.num_watching}}</b> )</p>


        <!-- listing table -->
    <table>
        <tr>
            <th>Title:</th>
        </tr>
        <td>
            <h3 class="test-text">{{item.title}} </h3>
        </td>

        <tr>
            <th>Image</th>
        </tr>
        <td>
            <img src="{{item.image}}" alt="immagine" height="150px" width="150px">
        </td>
        <tr>
            <th>Description:</th>
        </tr>
        <td>
            <p class="test-text">{{item.description}}</p>
        </td>
        <tr>
            <th>Owner:</th>
            <th>Category</th>
            <th>Date Published</th>
        </tr>
        <tr>
            <td>
                <p class="test-text">{{item.owner}}</p>
            </td>
            <td>
                <p class="test-text"><a href="{%url 'category' item.category%}">{{item.category}}</a></p>
            </td>
            <td>
                <p class="test-text">{{item.date}}</p>
            </td>
        </tr>


    </table>

    <h5><u>Price</u></h5>
    <p><b></b> <span class="test-text">{{item.current_bid}}</span>

        <!-- bid section -->
    <h4>Bidding</h4>
                    <!-- IF user authenticated bid form -->
                    {%if user.is_authenticated%}
                    {% if messages %}
                    <ul class="messages">
                       {% for message in messages %}
                            <li {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                      {% endfor %}
                     </ul>
                        {% endif %}

                        <!-- IF item is active -->
                                        {%if item.active%}
                                                                    <p><em>Active</em></p>

                                                                    <!-- IF user is owner, can't bid, only close -->
                                                                    {%if item.owner == user%}
                                                                        <p class="mx-5"><em>IS OWNER</em></p>
                                                                        <div class="d-flex inline-block">
                                                                            <form action="{%url 'close' item.id %}" method="post">
                                                                                {%csrf_token%}
                                                                                <button type="submit" class="btn btn-info" name="close_auction">Close Auction</button>
                                                                            </form>
                                                                        </div>
                                                                    <!-- ELIF user is not owner, place bid -->
                                                                    {%else%}
                                                                        <p class="mx-5"><em>NOT OWNER</em></p>
                                                                        <div class="d-flex inline-block">
                                                                            <form action="{%url 'bid' item.id %}"method="post">
                                                                                {%csrf_token%}

                                                                                {{bid_form.bid}}
                                                                                <button class="btn btn-success" name="place_bid">Bid</button>
                                                                            </form>
                                                                        </div>
                                                                        <!-- ENDIF bid/close auction -->
                                                                    {%endif%}

                                        <!-- ELSE item is not active -->
                                        {%else%}
                                                <!-- IF user IS owner, owner can see the user who bought it -->
                                                                    {%if item.owner == user%}
                                                                                        {%if item.owner == user and item.highest_bidder.user == owner%}
                                                                                            <p>no one bought it</p>
                                                                                        {%else%}
                                                                                            <p>auction is closed, user <b>{{item.highest_bidder.user}}</b> bought it.</p>
                                                                                        {%endif%}

                                                                    <!-- ELIF user is not owner -->
                                                                    {%else%}
                                                                                        <div class="d-flex inline-block">
                                                                        <!-- IF not owner highest bidder -->
                                                                                    {%if item.highest_bidder.user == user%}

                                                                                                    <p class="mx-5"><em>You won the auction</em></p>

                                                                                    <!-- ELIF not owner NOT highest bidder -->

                                                                                    {%else%}
                                                                                                        <p class="mx-5"><em>You didn't win the auction</em></p>
                                                                                    <!-- ENDIF not owner highest bidder -->
                                                                                    {%endif%}
                                                                                    </div>
                                                                    <!-- ENDIF user owner/not owner -->
                                                                    {%endif%}
                                        <!-- ENDIF item is active/not active -->
                                        {%endif%}

                    <!-- ELSE user is not authenticated to bid -->
                    {%else%}
                        <p class="test-msg"><u>you have to login/register to bid.</u></p>
                    <!-- ENDIF user is not authenticated to bid -->
                    {%endif%}

<!-- end bid section -->
                    <!-- === comment section === -->
                    <!-- display of messages -->
                        <table>
                            <tr>
                                <th><u>user</u></th>
                                <th><u>comment</u></th>
                            </tr>

                            {%for comm  in item.comments%}
                            <tr>
                                <td>{{comm.user.username}}</td>
                                <td>{{comm.text}}</td>
                            </tr>
                            {%empty%}
                            <p style="color:orange"><em><i>There are no comments here</i></em></p>
                            {%endfor%}
                        </table>
                    <!-- IF authenticated reply form -->
                    {%if user.is_authenticated%}
                    <p><u><i>text submit form</i></u></p>
                    <form action="{%url 'comment' item.id%}" method="post">
                        {%csrf_token%}
                        {{comment_form}}
                        <button class="btn btn-dark" name="send_comment">Add Comment</button>


                    </form>
                    <!-- ELSE not authenticated, no reply -->
                    {%endif%}
                    <!-- === END comment section === -->
<!-- ELIF there is an error in the page -->
{%elif error%}
    <h1>This item wasn't added yet</h1>
    <h2>{{error}}</h2>

<!-- ENDIF error in the page -->
{%endif%}


{% endblock %}